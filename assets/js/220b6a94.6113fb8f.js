"use strict";(self.webpackChunkjavascript_compiler_in_rust=self.webpackChunkjavascript_compiler_in_rust||[]).push([[983],{9613:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var r=n(9496);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=p(n),d=a,h=m["".concat(l,".").concat(d)]||m[d]||u[d]||i;return n?r.createElement(h,s(s({ref:t},c),{},{components:n})):r.createElement(h,s({ref:t},c))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,s=new Array(i);s[0]=m;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,s[1]=o;for(var p=2;p<i;p++)s[p]=n[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9618:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var r=n(2081),a=(n(9496),n(9613));const i={title:"The ECMAScript Specification"},s=void 0,o={permalink:"/javascript-compiler-in-rust/blog/ecma-spec",editUrl:"https://github.com/Boshen/javascript-compiler-in-rust/tree/main/blog/blog/ecma-spec.md",source:"@site/blog/ecma-spec.md",title:"The ECMAScript Specification",description:"The ECMAScript\xae 2023 Language Specification details everything about the JavaScript language, so anyone can implement their own JavaScript engine.",date:"2022-08-11T12:58:23.000Z",formattedDate:"August 11, 2022",tags:[],readingTime:3.025,hasTruncateMarker:!0,authors:[],frontMatter:{title:"The ECMAScript Specification"},nextItem:{title:"Grammar",permalink:"/javascript-compiler-in-rust/blog/grammar"}},l={authorsImageUrls:[]},p=[{value:"Chapter 5 Notational Conventions",id:"chapter-5-notational-conventions",level:2},{value:"Chapter 11 ECMAScript Language: Source Text",id:"chapter-11-ecmascript-language-source-text",level:2},{value:"Chapter 12 ECMAScript Language: Lexical Grammar",id:"chapter-12-ecmascript-language-lexical-grammar",level:2},{value:"Chapter 12.9 Automatic Semicolon Insertion",id:"chapter-129-automatic-semicolon-insertion",level:3},{value:"Chapter 13 - 16 Expressions, Statements, Functions, Classes, Scripts and Modules",id:"chapter-13---16-expressions-statements-functions-classes-scripts-and-modules",level:2},{value:"Identifiers",id:"identifiers",level:3},{value:"Expressions",id:"expressions",level:3},{value:"Parenthesized Expression",id:"parenthesized-expression",level:3},{value:"Cover Grammar",id:"cover-grammar",level:3},{value:"Restricted Productions",id:"restricted-productions",level:3},{value:"Arrow functions",id:"arrow-functions",level:3}],c={toc:p};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://tc39.es/ecma262/"},"The ECMAScript\xae 2023 Language Specification")," details everything about the JavaScript language, so anyone can implement their own JavaScript engine."),(0,a.kt)("p",null,"For our compiler, we will study the following chapters:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Chapter 5 Notational Conventions"),(0,a.kt)("li",{parentName:"ul"},"Chapter 11 ECMAScript Language: Source Text"),(0,a.kt)("li",{parentName:"ul"},"Chapter 12 ECMAScript Language: Lexical Grammar"),(0,a.kt)("li",{parentName:"ul"},"Chapter 13 - 16 Expressions, Statements, Functions, Classes, Scripts and Modules"),(0,a.kt)("li",{parentName:"ul"},"Chapter B Additional ECMAScript Features for Web Browsers"),(0,a.kt)("li",{parentName:"ul"},"Chapter C The Strict Mode of ECMAScript")),(0,a.kt)("h2",{id:"chapter-5-notational-conventions"},"Chapter 5 Notational Conventions"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://tc39.es/ecma262/#sec-grammar-notation"},"Chapter 5.1.5 Grammar Notation")," is the section you need to read."),(0,a.kt)("p",null,"The things to note here are:"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Recursion")),(0,a.kt)("p",null,"This is how lists are presented in the grammar."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-markup"},"ArgumentList :\n  AssignmentExpression\n  ArgumentList , AssignmentExpression\n")),(0,a.kt)("p",null,"means"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"a, b = 1, c = 2\n^_____________^ ArgumentList\n   ^__________^ ArgumentList, AssignmentExpression,\n          ^___^ AssignmentExpression\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Optional"),"\nThe ",(0,a.kt)("inlineCode",{parentName:"p"},"_opt_")," suffix for optional syntax. For example,"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-markup"},"VariableDeclaration :\n  BindingIdentifier Initializer_opt\n")),(0,a.kt)("p",null,"means"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"var binding_identifier;\nvar binding_identifier = Initializer;\n                       ______________ Initializer_opt\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Parameters")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"[Return]")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"[In]")," are parameters of the grammar."),(0,a.kt)("p",null,"For example"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-markdup"},"ScriptBody :\n    StatementList[~Yield, ~Await, ~Return]\n")),(0,a.kt)("p",null,"means top-level yield, await and return are not allowed in scripts, but"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-markdup"},"ModuleItem :\n  ImportDeclaration\n  ExportDeclaration\n  StatementListItem[~Yield, +Await, ~Return]\n")),(0,a.kt)("p",null,"allows for top-level return."),(0,a.kt)("h2",{id:"chapter-11-ecmascript-language-source-text"},"Chapter 11 ECMAScript Language: Source Text"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://tc39.es/ecma262/#sec-types-of-source-code"},"Chapter 11.2 Types of Source Code")," tells us that\nthere is a huge distinction between script code and module code.\nAnd there is a ",(0,a.kt)("inlineCode",{parentName:"p"},"use strict")," mode that makes the grammar saner by disallowing old JavaScript behaviors."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Script Code")," is not strict, ",(0,a.kt)("inlineCode",{parentName:"p"},"use strict")," need to be inserted at the top of the file to make script code strict.\nIn html you write ",(0,a.kt)("inlineCode",{parentName:"p"},'<script src="javascript.js"><\/script>'),"."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Module Code")," is automatically strict.\nIn html you write ",(0,a.kt)("inlineCode",{parentName:"p"},'<script type="module" src="main.mjs"><\/script>'),"."),(0,a.kt)("h2",{id:"chapter-12-ecmascript-language-lexical-grammar"},"Chapter 12 ECMAScript Language: Lexical Grammar"),(0,a.kt)("p",null,"For more in-depth explanation, you can read the V8 blog on ",(0,a.kt)("a",{parentName:"p",href:"https://v8.dev/blog/understanding-ecmascript-part-3"},"Understanding the ECMAScript spec"),"."),(0,a.kt)("h3",{id:"chapter-129-automatic-semicolon-insertion"},(0,a.kt)("a",{parentName:"h3",href:"https://tc39.es/ecma262/#sec-automatic-semicolon-insertion"},"Chapter 12.9 Automatic Semicolon Insertion")),(0,a.kt)("p",null,"This section describes all the rules that you need can omit a semicolon while writing JavaScript.\nAll the explanation boils down to"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-rust"},"    pub fn asi(&mut self) -> Result<()> {\n        if self.eat(Kind::Semicolon) || self.can_insert_semicolon() {\n            return Ok(());\n        }\n        let range = self.prev_node_end..self.cur_token().start;\n        Err(SyntaxError::AutoSemicolonInsertion(range.into()))\n    }\n\n    pub const fn can_insert_semicolon(&self) -> bool {\n        self.cur_token().is_on_new_line || matches!(self.cur_kind(), Kind::RCurly | Kind::Eof)\n    }\n")),(0,a.kt)("p",null,"and in parser code"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-rust"},"    fn parse_debugger_statement(&mut self) -> Result<Statement<'a>> {\n        let node = self.start_node();\n        self.expect(Kind::Debugger)?;\n        // highlight-next-line\n        self.asi()?;\n        self.ast.debugger_statement(self.finish_node(node))\n    }\n")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"This section on asi is written with a parser in mind,\nit explicitly states that the source text is parsed from left to right,\nwhich makes it almost impossible to write the parser in any other way.\nThe author of jsparagus made a rant about this ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/mozilla-spidermonkey/jsparagus/blob/master/js-quirks.md#automatic-semicolon-insertion-"},"here"),"."),(0,a.kt)("blockquote",{parentName:"admonition"},(0,a.kt)("p",{parentName:"blockquote"},"The specification for this feature is both very-high-level and weirdly procedural (\u201cWhen, as the source text is parsed from left to right, a token is encountered...\u201d, as if the specification is telling a story about a browser. As far as I know, this is the only place in the spec where anything is assumed or implied about the internal implementation details of parsing.) But it would be hard to specify ASI any other way."))),(0,a.kt)("h2",{id:"chapter-13---16-expressions-statements-functions-classes-scripts-and-modules"},"Chapter 13 - 16 Expressions, Statements, Functions, Classes, Scripts and Modules"),(0,a.kt)("h3",{id:"identifiers"},"Identifiers"),(0,a.kt)("p",null,"Distinguish between an identifier reference and binding identifier."),(0,a.kt)("h3",{id:"expressions"},"Expressions"),(0,a.kt)("p",null,"Pratt parsing."),(0,a.kt)("h3",{id:"parenthesized-expression"},"Parenthesized Expression"),(0,a.kt)("p",null,"Meaningless expect this one litter corner ... ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/estree/estree/issues/194"},"https://github.com/estree/estree/issues/194")),(0,a.kt)("h3",{id:"cover-grammar"},"Cover Grammar"),(0,a.kt)("p",null,"Cover grammar will be your first painful experience while understanding JavaScript from a parser point of view.\nRead the ",(0,a.kt)("a",{parentName:"p",href:"https://v8.dev/blog/understanding-ecmascript-part-4"},"intro V8 blog post")," on this topic first,\nand I'll cover this in ",(0,a.kt)("a",{parentName:"p",href:"/blog/grammar"},"this tutorial"),"."),(0,a.kt)("h3",{id:"restricted-productions"},"Restricted Productions"),(0,a.kt)("p",null,"Parse ",(0,a.kt)("inlineCode",{parentName:"p"},"/")," and templates."),(0,a.kt)("h3",{id:"arrow-functions"},"Arrow functions"))}u.isMDXComponent=!0}}]);